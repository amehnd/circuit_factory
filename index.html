<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Circuit Factory</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@300;400;500;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:       #06080b;
  --surface:  #0b0f14;
  --surface2: #111820;
  --border:   #1a2535;
  --border2:  #243040;
  --cyan:     #00d4ff;
  --green:    #00ff9d;
  --orange:   #ff6b35;
  --purple:   #a855f7;
  --text:     #b8cdd8;
  --muted:    #3d5565;
  --mono:     'JetBrains Mono', monospace;
  --display:  'Orbitron', sans-serif;
  --body:     'Syne', sans-serif;
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--body);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ NOISE + GRID BACKGROUND â”€â”€ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(0,212,255,0.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,212,255,0.025) 1px, transparent 1px);
  background-size: 48px 48px;
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€ CORNER GLOW â”€â”€ */
body::after {
  content: '';
  position: fixed;
  top: -200px; left: -200px;
  width: 600px; height: 600px;
  background: radial-gradient(circle, rgba(0,212,255,0.04) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}

.page {
  position: relative;
  z-index: 1;
  max-width: 1180px;
  margin: 0 auto;
  padding: 0 28px 100px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
header {
  padding: 56px 0 40px;
  margin-bottom: 52px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 32px;
}

.brand { flex: 1; min-width: 220px; }

.eyebrow {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 5px;
  color: var(--cyan);
  text-transform: uppercase;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.eyebrow::before {
  content: '';
  width: 24px;
  height: 1px;
  background: var(--cyan);
}

h1 {
  font-family: var(--display);
  font-size: clamp(36px, 6vw, 72px);
  font-weight: 900;
  line-height: 1;
  color: #fff;
  letter-spacing: 1px;
}

h1 em {
  font-style: normal;
  color: transparent;
  -webkit-text-stroke: 1px var(--cyan);
}

.header-counters {
  display: flex;
  gap: 40px;
}

.counter {
  text-align: center;
  position: relative;
}

.counter::before {
  content: '';
  position: absolute;
  inset: -10px -16px;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: var(--surface);
}

.counter-val {
  font-family: var(--display);
  font-size: 36px;
  font-weight: 700;
  color: var(--green);
  display: block;
  position: relative;
}

.counter-label {
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 3px;
  color: var(--muted);
  text-transform: uppercase;
  position: relative;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION LABELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-label {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 4px;
  color: var(--cyan);
  text-transform: uppercase;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.sec-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: linear-gradient(to right, var(--border2), transparent);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPEC INPUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.spec-section { margin-bottom: 28px; }

.input-wrap {
  display: flex;
  gap: 12px;
  align-items: stretch;
  position: relative;
}

.spec-input {
  flex: 1;
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 6px;
  padding: 18px 22px;
  font-family: var(--mono);
  font-size: 14px;
  color: #fff;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
}

.spec-input::placeholder { color: var(--muted); }

.spec-input:focus {
  border-color: var(--cyan);
  background: #0d1520;
  box-shadow: 0 0 0 3px rgba(0,212,255,0.08), inset 0 1px 0 rgba(0,212,255,0.04);
}

.run-btn {
  background: var(--cyan);
  border: none;
  border-radius: 6px;
  padding: 18px 36px;
  font-family: var(--display);
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 2px;
  color: #000;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
  position: relative;
  overflow: hidden;
}

.run-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.25), transparent);
  opacity: 0;
  transition: opacity 0.15s;
}

.run-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 32px rgba(0,212,255,0.35); }
.run-btn:hover::before { opacity: 1; }
.run-btn:active { transform: translateY(0); }
.run-btn:disabled { background: var(--muted); cursor: not-allowed; transform: none; box-shadow: none; }

.chips {
  margin-top: 12px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.chips-label {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 2px;
}

.chip {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 5px 12px;
  cursor: pointer;
  transition: all 0.15s;
  user-select: none;
}

.chip:hover {
  color: var(--cyan);
  border-color: var(--cyan);
  background: rgba(0,212,255,0.04);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TERMINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.terminal {
  background: #040608;
  border: 1px solid var(--border);
  border-radius: 6px;
  margin-bottom: 36px;
  overflow: hidden;
}

.terminal-bar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.t-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
}

.t-dot.red   { background: #ff5f57; }
.t-dot.amber { background: #febc2e; }
.t-dot.green { background: #28c840; }

.terminal-label {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 2px;
  margin-left: auto;
}

.terminal-body {
  padding: 18px 20px;
  font-family: var(--mono);
  font-size: 12px;
  line-height: 1.9;
  min-height: 72px;
  max-height: 220px;
  overflow-y: auto;
}

.log { margin: 0; }
.log.info  { color: var(--cyan); }
.log.ok    { color: var(--green); }
.log.warn  { color: var(--orange); }
.log.dim   { color: var(--muted); }
.log.white { color: #fff; }

.cursor-blink {
  display: inline-block;
  width: 7px; height: 13px;
  background: var(--cyan);
  margin-left: 3px;
  vertical-align: middle;
  animation: blink 1s step-end infinite;
}

@keyframes blink { 0%,100%{opacity:1}50%{opacity:0} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOW IT WORKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hiw {
  margin-bottom: 36px;
  border: 1px solid var(--border);
  border-radius: 6px;
  overflow: hidden;
}

.hiw-header {
  background: var(--surface);
  padding: 14px 22px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s;
}

.hiw-header:hover { background: var(--surface2); }

.hiw-title {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 4px;
  color: var(--cyan);
  text-transform: uppercase;
}

.hiw-chevron {
  color: var(--muted);
  font-size: 11px;
  transition: transform 0.25s;
}

.hiw-chevron.open { transform: rotate(180deg); }

.hiw-body {
  padding: 32px 28px;
  background: #080c10;
  border-top: 1px solid var(--border);
}

/* Pipeline */
.pipeline {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 24px 28px;
  margin-bottom: 40px;
}

.pipe-node {
  flex: 1;
  min-width: 90px;
  text-align: center;
}

.pipe-icon {
  font-size: 28px;
  display: block;
  margin-bottom: 8px;
}

.pipe-name {
  font-family: var(--display);
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
  color: #fff;
  margin-bottom: 4px;
}

.pipe-sub {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--muted);
}

.pipe-sep {
  color: var(--cyan);
  font-size: 20px;
  flex-shrink: 0;
  opacity: 0.6;
}

@media(max-width:640px){.pipe-sep{display:none}.pipeline{gap:20px;justify-content:center}}

/* Weight grid */
.hiw-subtitle {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 3px;
  text-transform: uppercase;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 20px;
}

.weight-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
  gap: 14px;
  margin-bottom: 8px;
}

.weight-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 18px;
  transition: border-color 0.2s;
}

.weight-card:hover { border-color: var(--border2); }

.wc-kw {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--cyan);
  letter-spacing: 1px;
  margin-bottom: 16px;
}

.wc-bars { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }

.wc-row {
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
}

.wc-row > span:first-child { width: 72px; flex-shrink: 0; }

.wc-bg {
  flex: 1;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
}

.wc-fill {
  height: 100%;
  border-radius: 2px;
  background: var(--cyan);
  transition: width 0.7s ease;
}

.wc-pct { width: 32px; text-align: right; color: #fff; }

.wc-note {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--green);
  border-top: 1px solid var(--border);
  padding-top: 10px;
}

/* Topologies */
.topo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
  gap: 14px;
  margin-bottom: 28px;
}

.topo-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 20px;
  transition: border-color 0.2s, transform 0.2s;
}

.topo-card:hover { border-color: var(--border2); transform: translateY(-2px); }

.topo-part {
  font-family: var(--display);
  font-size: 24px;
  font-weight: 700;
  color: var(--cyan);
  letter-spacing: 1px;
  margin-bottom: 4px;
}

.topo-name {
  font-family: var(--mono);
  font-size: 11px;
  color: #fff;
  letter-spacing: 1px;
  margin-bottom: 12px;
}

.topo-desc {
  font-size: 13px;
  color: var(--muted);
  line-height: 1.6;
  margin-bottom: 14px;
}

.topo-tags { display: flex; gap: 6px; flex-wrap: wrap; }

.topo-tag {
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 1px;
  padding: 3px 9px;
  border: 1px solid var(--border);
  border-radius: 2px;
  color: var(--muted);
}

/* Footprint warning */
.warn-box {
  display: flex;
  gap: 16px;
  padding: 18px 22px;
  background: rgba(255,107,53,0.05);
  border: 1px solid rgba(255,107,53,0.2);
  border-radius: 4px;
}

.warn-icon { font-size: 20px; flex-shrink: 0; margin-top: 2px; }

.warn-text {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  line-height: 1.75;
}

.warn-text strong { color: var(--orange); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ARENA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.arena { display: none; }
.arena.visible {
  display: block;
  animation: fadeUp 0.45s cubic-bezier(0.22,1,0.36,1) forwards;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(24px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* Scoreboard */
.scoreboard {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 44px;
}

@media(max-width:640px){ .scoreboard { grid-template-columns: 1fr; } }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 26px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: var(--border2);
  transition: background 0.3s;
}

.card.winner {
  border-color: var(--green);
  box-shadow: 0 0 40px rgba(0,255,157,0.1);
}

.card.winner::before { background: var(--green); }

.card-name {
  font-family: var(--display);
  font-size: 20px;
  font-weight: 700;
  letter-spacing: 1px;
  margin-bottom: 2px;
  color: #fff;
}

.card.winner .card-name { color: var(--green); }

.card-role {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--muted);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 20px;
}

.card-score {
  font-family: var(--display);
  font-size: 44px;
  font-weight: 900;
  color: #fff;
  line-height: 1;
  margin-bottom: 2px;
}

.card-score-label {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  margin-bottom: 14px;
}

.score-track {
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 16px;
}

.score-fill {
  height: 100%;
  background: var(--cyan);
  border-radius: 2px;
  width: 0;
  transition: width 1.2s cubic-bezier(0.22,1,0.36,1);
}

.card.winner .score-fill { background: var(--green); }

.validity-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 2px;
  padding: 4px 10px;
  border-radius: 2px;
}

.validity-badge.valid   { background: rgba(0,255,157,0.1); color: var(--green); }
.validity-badge.invalid { background: rgba(255,107,53,0.1); color: var(--orange); }

.card-meta {
  margin-top: 14px;
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  line-height: 1.7;
}

.crown {
  position: absolute;
  top: 14px; right: 16px;
  font-size: 22px;
  animation: levitate 2.5s ease-in-out infinite;
}

@keyframes levitate {
  0%,100%{ transform: translateY(0) rotate(-4deg); }
  50%    { transform: translateY(-5px) rotate(4deg); }
}

/* â”€â”€ WINNER PANEL â”€â”€ */
.winner-panel {
  background: var(--surface);
  border: 1px solid var(--green);
  border-radius: 6px;
  padding: 36px;
  margin-bottom: 36px;
  box-shadow: 0 0 60px rgba(0,255,157,0.05);
  position: relative;
  overflow: hidden;
}

.winner-panel::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(to right, var(--green), transparent 60%);
}

.wp-head {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 28px;
}

.wp-title {
  font-family: var(--display);
  font-size: clamp(28px, 4vw, 42px);
  font-weight: 900;
  color: var(--green);
  letter-spacing: 1px;
  line-height: 1;
}

.wp-subtitle {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--muted);
  margin-top: 8px;
  max-width: 480px;
  line-height: 1.6;
}

.wp-metrics {
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
}

.metric {
  text-align: right;
  min-width: 60px;
}

.metric-val {
  font-family: var(--display);
  font-size: 22px;
  font-weight: 700;
  color: #fff;
  display: block;
}

.metric-label {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--muted);
  letter-spacing: 2px;
  text-transform: uppercase;
}

.comp-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 24px;
}

.comp-tag {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--cyan);
  border: 1px solid rgba(0,212,255,0.25);
  border-radius: 3px;
  padding: 6px 14px;
  background: rgba(0,212,255,0.04);
  transition: border-color 0.15s;
}

.comp-tag:hover { border-color: var(--cyan); }

.wp-note {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--muted);
  border-left: 2px solid var(--green);
  padding-left: 16px;
  margin-bottom: 28px;
  line-height: 1.7;
}

/* Cost table */
.cost-header {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 12px;
}

.cost-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--mono);
  font-size: 11px;
}

.cost-table thead tr {
  border-bottom: 1px solid var(--border2);
}

.cost-table th {
  color: var(--muted);
  font-weight: 400;
  padding: 6px 10px;
  text-align: left;
}

.cost-table th:last-child,
.cost-table th:nth-child(4) { text-align: right; }

.cost-table tbody tr {
  border-bottom: 1px solid var(--border);
  transition: background 0.1s;
}

.cost-table tbody tr:hover { background: rgba(255,255,255,0.02); }

.cost-table td { padding: 8px 10px; color: var(--text); }

.cost-table .td-ref { color: var(--cyan); }
.cost-table .td-val { color: #fff; }
.cost-table .td-num { text-align: right; }
.cost-table .td-total { text-align: right; color: var(--green); }

.cost-table tfoot tr {
  border-top: 2px solid var(--green);
}

.cost-table tfoot td { padding: 10px; }

.cost-basis {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  border-left: 2px solid var(--orange);
  padding-left: 14px;
  margin-top: 14px;
  line-height: 1.65;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILE OUTPUTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs-header {
  display: flex;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  border-radius: 6px 6px 0 0;
  border: 1px solid var(--border);
  border-bottom: none;
}

.tab-btn {
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  padding: 14px 22px;
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  cursor: pointer;
  transition: color 0.15s, border-color 0.15s;
  margin-bottom: -1px;
}

.tab-btn:hover { color: var(--text); }
.tab-btn.active { color: var(--cyan); border-bottom-color: var(--cyan); }

.tabs-body {
  background: var(--surface);
  border: 1px solid var(--border);
  border-top: none;
  border-radius: 0 0 6px 6px;
  margin-bottom: 44px;
}

.tab-pane { display: none; padding: 24px; }
.tab-pane.active { display: block; }

pre.code {
  background: #03050a;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 22px;
  font-family: var(--mono);
  font-size: 11.5px;
  line-height: 1.75;
  color: #7a9fb0;
  overflow-x: auto;
  max-height: 360px;
  overflow-y: auto;
  margin-bottom: 0;
  white-space: pre;
  tab-size: 2;
}

.c-comment { color: #2d4455; }
.c-key     { color: var(--cyan); }
.c-val     { color: var(--green); }
.c-str     { color: #e8a87c; }

.dl-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 14px;
  padding: 14px 24px;
  border-top: 1px solid var(--border);
}

.dl-meta {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
}

.dl-btn {
  background: none;
  border: 1px solid var(--cyan);
  color: var(--cyan);
  border-radius: 3px;
  padding: 9px 22px;
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}

.dl-btn:hover { background: rgba(0,212,255,0.08); box-shadow: 0 0 20px rgba(0,212,255,0.2); }
.dl-btn.green { border-color: var(--green); color: var(--green); }
.dl-btn.green:hover { background: rgba(0,255,157,0.06); box-shadow: 0 0 20px rgba(0,255,157,0.15); }
.dl-btn.orange { border-color: var(--orange); color: var(--orange); }
.dl-btn.orange:hover { background: rgba(255,107,53,0.06); box-shadow: 0 0 20px rgba(255,107,53,0.15); }

/* â”€â”€ SPINNER â”€â”€ */
.spin {
  display: inline-block;
  width: 13px; height: 13px;
  border: 2px solid var(--border2);
  border-top-color: var(--cyan);
  border-radius: 50%;
  animation: spin 0.65s linear infinite;
  margin-right: 8px;
  vertical-align: middle;
}

@keyframes spin { to { transform: rotate(360deg); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer {
  border-top: 1px solid var(--border);
  padding-top: 28px;
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 12px;
}

footer p {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
}

footer a { color: var(--cyan); text-decoration: none; }
footer a:hover { text-decoration: underline; }

/* scrollbar */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
</style>
</head>
<body>



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page">

  <header>
    <div class="brand">
      <div class="eyebrow">v2.2 Â· <span style="color:#00ff9d;letter-spacing:3px;">âš¡ LIVE AI</span></div>
      <h1>AI CIRCUIT<br><em>FACTORY</em></h1>
    </div>
    <div class="header-counters">
      <div class="counter">
        <span class="counter-val" id="total-runs">0</span>
        <span class="counter-label">Circuits<br>Built</span>
      </div>
      <div class="counter">
        <span class="counter-val">3</span>
        <span class="counter-label">AI<br>Models</span>
      </div>
      <div class="counter">
        <span class="counter-val">3</span>
        <span class="counter-label">File<br>Formats</span>
      </div>
    </div>
  </header>

  <!-- Input -->
  <section class="spec-section">
    <div class="sec-label">Circuit Specification</div>
    <div class="input-wrap">
      <input class="spec-input" id="spec-input" type="text"
        placeholder="e.g.  15mA laser driver cheap  Â·  100mA LED driver precise  Â·  5V buck converter"
        maxlength="120">
      <button class="run-btn" id="run-btn" onclick="runFactory()">RUN â–¶</button>
    </div>
    <div class="chips">
      <span class="chips-label">TRY:</span>
      <span class="chip" onclick="setSpec(this)">15mA laser driver cheap</span>
      <span class="chip" onclick="setSpec(this)">100mA LED driver precise</span>
      <span class="chip" onclick="setSpec(this)">50mA motor driver MOSFET</span>
      <span class="chip" onclick="setSpec(this)">20mA IR emitter feedback</span>
      <span class="chip" onclick="setSpec(this)">battery-powered 10mA sensor</span>
    </div>
  </section>

  <!-- Terminal -->
  <div class="terminal">
    <div class="terminal-bar">
      <span class="t-dot red"></span>
      <span class="t-dot amber"></span>
      <span class="t-dot green"></span>
      <span class="terminal-label">SYSTEM LOG // AI CIRCUIT FACTORY</span>
    </div>
    <div class="terminal-body" id="terminal">
      <p class="log dim">// AI Circuit Factory â€” 3 Claude personas competing (GPT-4o style Â· Claude style Â· Gemini style).</p>
      <p class="log dim">// Outputs: LTspice .asc Â· KiCad .kicad_sch Â· Bill of Materials .csv</p>
      <p class="log dim">// Enter any circuit spec â€” fully dynamic, no hardcoding.</p>
      <span class="cursor-blink"></span>
    </div>
  </div>

  <!-- How it works -->
  <div class="hiw">
    <div class="hiw-header" onclick="toggleHIW()">
      <span class="hiw-title">// How the judging works</span>
      <span class="hiw-chevron" id="hiw-chevron">&#9660;</span>
    </div>
    <div class="hiw-body" id="hiw-body" style="display:none">

      <div class="pipeline">
        <div class="pipe-node">
          <span class="pipe-icon">ğŸ“</span>
          <div class="pipe-name">YOUR SPEC</div>
          <div class="pipe-sub">"15mA laser cheap"</div>
        </div>
        <span class="pipe-sep">â†’</span>
        <div class="pipe-node">
          <span class="pipe-icon">ğŸ¤–</span>
          <div class="pipe-name">3 AI MODELS</div>
          <div class="pipe-sub">GPT-4o Â· Claude Â· Gemini Flash</div>
        </div>
        <span class="pipe-sep">â†’</span>
        <div class="pipe-node">
          <span class="pipe-icon">âš¡</span>
          <div class="pipe-name">PHYSICS CHECK</div>
          <div class="pipe-sub">V/I/R validation</div>
        </div>
        <span class="pipe-sep">â†’</span>
        <div class="pipe-node">
          <span class="pipe-icon">ğŸ†</span>
          <div class="pipe-name">WINNER SCORED</div>
          <div class="pipe-sub">Weighted formula</div>
        </div>
        <span class="pipe-sep">â†’</span>
        <div class="pipe-node">
          <span class="pipe-icon">ğŸ“</span>
          <div class="pipe-name">3 FILES OUT</div>
          <div class="pipe-sub">.asc / .sch / .csv</div>
        </div>
      </div>

      <div class="hiw-subtitle">SCORING WEIGHTS â€” AUTO-DETECTED FROM YOUR KEYWORDS</div>

      <div class="weight-grid">
        <div class="weight-card">
          <div class="wc-kw">keyword: "cheap"</div>
          <div class="wc-bars">
            <div class="wc-row"><span>Cost</span><div class="wc-bg"><div class="wc-fill" style="width:60%;background:var(--green)"></div></div><span class="wc-pct">60%</span></div>
            <div class="wc-row"><span>Accuracy</span><div class="wc-bg"><div class="wc-fill" style="width:20%"></div></div><span class="wc-pct">20%</span></div>
            <div class="wc-row"><span>Size</span><div class="wc-bg"><div class="wc-fill" style="width:15%"></div></div><span class="wc-pct">15%</span></div>
            <div class="wc-row"><span>Efficiency</span><div class="wc-bg"><div class="wc-fill" style="width:5%"></div></div><span class="wc-pct">5%</span></div>
          </div>
          <div class="wc-note">â†’ Cost-optimised design wins</div>
        </div>
        <div class="weight-card">
          <div class="wc-kw">keyword: "precise" / "low noise"</div>
          <div class="wc-bars">
            <div class="wc-row"><span>Accuracy</span><div class="wc-bg"><div class="wc-fill" style="width:60%;background:var(--cyan)"></div></div><span class="wc-pct">60%</span></div>
            <div class="wc-row"><span>Cost</span><div class="wc-bg"><div class="wc-fill" style="width:20%"></div></div><span class="wc-pct">20%</span></div>
            <div class="wc-row"><span>Size</span><div class="wc-bg"><div class="wc-fill" style="width:15%"></div></div><span class="wc-pct">15%</span></div>
            <div class="wc-row"><span>Efficiency</span><div class="wc-bg"><div class="wc-fill" style="width:5%"></div></div><span class="wc-pct">5%</span></div>
          </div>
          <div class="wc-note">â†’ Performance design wins</div>
        </div>
        <div class="weight-card">
          <div class="wc-kw">keyword: "small" / "tiny"</div>
          <div class="wc-bars">
            <div class="wc-row"><span>Size</span><div class="wc-bg"><div class="wc-fill" style="width:50%;background:var(--purple)"></div></div><span class="wc-pct">50%</span></div>
            <div class="wc-row"><span>Cost</span><div class="wc-bg"><div class="wc-fill" style="width:30%"></div></div><span class="wc-pct">30%</span></div>
            <div class="wc-row"><span>Accuracy</span><div class="wc-bg"><div class="wc-fill" style="width:15%"></div></div><span class="wc-pct">15%</span></div>
            <div class="wc-row"><span>Efficiency</span><div class="wc-bg"><div class="wc-fill" style="width:5%"></div></div><span class="wc-pct">5%</span></div>
          </div>
          <div class="wc-note">â†’ Smallest footprint wins</div>
        </div>
        <div class="weight-card">
          <div class="wc-kw">keyword: "battery powered"</div>
          <div class="wc-bars">
            <div class="wc-row"><span>Efficiency</span><div class="wc-bg"><div class="wc-fill" style="width:40%;background:var(--orange)"></div></div><span class="wc-pct">40%</span></div>
            <div class="wc-row"><span>Cost</span><div class="wc-bg"><div class="wc-fill" style="width:30%"></div></div><span class="wc-pct">30%</span></div>
            <div class="wc-row"><span>Accuracy</span><div class="wc-bg"><div class="wc-fill" style="width:20%"></div></div><span class="wc-pct">20%</span></div>
            <div class="wc-row"><span>Size</span><div class="wc-bg"><div class="wc-fill" style="width:10%"></div></div><span class="wc-pct">10%</span></div>
          </div>
          <div class="wc-note">â†’ Lowest power loss wins</div>
        </div>
        <div class="weight-card">
          <div class="wc-kw">no keyword (balanced default)</div>
          <div class="wc-bars">
            <div class="wc-row"><span>Cost</span><div class="wc-bg"><div class="wc-fill" style="width:40%"></div></div><span class="wc-pct">40%</span></div>
            <div class="wc-row"><span>Accuracy</span><div class="wc-bg"><div class="wc-fill" style="width:30%"></div></div><span class="wc-pct">30%</span></div>
            <div class="wc-row"><span>Size</span><div class="wc-bg"><div class="wc-fill" style="width:20%"></div></div><span class="wc-pct">20%</span></div>
            <div class="wc-row"><span>Efficiency</span><div class="wc-bg"><div class="wc-fill" style="width:10%"></div></div><span class="wc-pct">10%</span></div>
          </div>
          <div class="wc-note">â†’ Best all-round design wins</div>
        </div>
      </div>

      <div class="hiw-subtitle" style="margin-top:36px">COMMON TOPOLOGIES</div>

      <div class="topo-grid">
        <div class="topo-card">
          <div class="topo-part">2N3904</div>
          <div class="topo-name">NPN Current Source</div>
          <div class="topo-desc">Jellybean NPN BJT with base bias and emitter sense resistor. Cheapest discrete option, slightly less accurate (Â±10-15%).</div>
          <div class="topo-tags"><span class="topo-tag">cheap</span><span class="topo-tag">discrete</span></div>
        </div>
        <div class="topo-card">
          <div class="topo-part">LM317 / LM358</div>
          <div class="topo-name">IC Regulator / Op-Amp</div>
          <div class="topo-desc">Industry-standard ICs. LM317 for voltage regulation, LM358 for precision feedback current control. Well-documented, bulletproof.</div>
          <div class="topo-tags"><span class="topo-tag">precise</span><span class="topo-tag">IC</span></div>
        </div>
        <div class="topo-card">
          <div class="topo-part">2N7002</div>
          <div class="topo-name">NMOS Feedback Loop</div>
          <div class="topo-desc">N-channel enhancement MOSFET with feedback sensing. Better precision than BJT, minimal gate drive, ideal for 3.3V logic systems.</div>
          <div class="topo-tags"><span class="topo-tag">balanced</span><span class="topo-tag">MOSFET</span></div>
        </div>
      </div>

      <div class="warn-box">
        <span class="warn-icon">âš ï¸</span>
        <div class="warn-text">
          <strong>Why footprint accuracy matters:</strong> A wrong footprint means ordering a PCB, waiting 7 days, and discovering the pads don't match. That's â‚¹2000 wasted and a week lost. Always cross-check KiCad footprints against the manufacturer datasheet before sending to fab.
        </div>
      </div>

    </div>
  </div>

  <!-- Arena -->
  <div class="arena" id="arena">

    <div class="sec-label">Competition Results</div>
    <div class="scoreboard" id="scoreboard"></div>

    <div class="sec-label">Winner Design</div>
    <div class="winner-panel" id="winner-panel"></div>

    <div class="sec-label">Generated Files</div>
    <div class="tabs-header">
      <button class="tab-btn active" onclick="switchTab('ltspice', this)">LTspice .asc</button>
      <button class="tab-btn" onclick="switchTab('kicad', this)">KiCad .sch</button>
      <button class="tab-btn" onclick="switchTab('bom', this)">BOM .csv</button>
    </div>
    <div class="tabs-body">
      <div class="tab-pane active" id="tab-ltspice"></div>
      <div class="tab-pane" id="tab-kicad"></div>
      <div class="tab-pane" id="tab-bom"></div>
    </div>

  </div>

  <footer>
    <p>AI Circuit Factory â€” Pure client-side. No backend. GPT-4o vs Claude vs Gemini.</p>
    <p>Built for <a href="https://pages.github.com" target="_blank">GitHub Pages</a> Â· OpenAI Â· Anthropic Â· Google</p>
  </footer>

</div>

<script>
'use strict';

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ğŸ” INSERT YOUR API KEYS HERE
   - OPENAI_KEY  : from platform.openai.com
   - OPENROUTER_KEY : from openrouter.ai  â† used for Claude (Anthropic blocks CORS)
   - GEMINI_KEY  : from aistudio.google.com
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
// const OPENAI_KEY='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';
const OPENAI_KEY='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';
const ANTHROPIC_KEY='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';
const GEMINI_KEY='AIzaSyCRnRFhORzqwJ0S8fqEqLYV118izJZvPSA';

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STATE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let runCount = parseInt(localStorage.getItem('cf_runs') || '0');
let currentFiles = {};

document.getElementById('total-runs').textContent = runCount;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   AI MODELS â€” one per LLM provider
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const AI_MODELS = [
  { name: 'GPT-4o',           key: 'gpt',    engine: 'openai'    },
  { name: 'Claude Sonnet',    key: 'claude', engine: 'anthropic' },
  { name: 'Gemini 1.5 Flash', key: 'gemini', engine: 'google'    }
];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SHARED PROMPT BUILDER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildPrompt(spec) {
  return `Design a specific circuit to meet this requirement: "${spec}"

Estimate realistic component costs in Indian Rupees (INR) for qty=10 from LCSC/DigiKey/Mouser.

Respond with ONLY valid JSON â€” no markdown fences, no text outside the JSON:
{
  "topology": "short_name_no_spaces",
  "components": [
    {"ref":"Q1","value":"2N3904","description":"NPN BJT","qty":1,"unit_cost_inr":4.50}
  ],
  "r_sense_ohms": 68,
  "total_cost_inr": 5.80,
  "size_mm": "4x4",
  "accuracy_pct": 88,
  "power_loss_w": 0.18,
  "physics_valid": true,
  "score": 8.2,
  "notes": "One sentence: topology choice and why it suits the spec.",
  "cost_breakdown_notes": "One sentence: how you derived these cost estimates."
}

Score 0-10: honest self-assessment of how well your design meets the full spec. Do not inflate.`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LIVE AI â€” all 3 models powered by Claude
   Each call uses a different persona prompt
   so GPT-4o, Gemini & Claude give genuinely
   different circuit designs for any spec.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

const JSON_SCHEMA = `Respond with ONLY valid JSON, no markdown, no text outside it:
{
  "topology": "short_topology_name_no_spaces",
  "components": [
    {"ref":"U1","value":"LM358","description":"Dual Op-Amp","qty":1,"unit_cost_inr":12.00}
  ],
  "r_sense_ohms": 68,
  "total_cost_inr": 28.50,
  "size_mm": "5x5",
  "accuracy_pct": 91,
  "power_loss_w": 0.14,
  "physics_valid": true,
  "score": 8.3,
  "notes": "One sentence: topology choice and why it suits the spec.",
  "cost_breakdown_notes": "One sentence: how you estimated INR costs for qty=10."
}
Score 0-10 honestly. Do not inflate. Estimate realistic INR component costs for qty=10 from LCSC/DigiKey/Mouser.`;

const PERSONAS = {
  openai: `You are GPT-4o, an AI assistant made by OpenAI. You are designing a circuit.
Your style: prefer op-amp feedback topologies (LM358, LM741, TL071), use 1% resistors, prioritise regulation accuracy.
You favour IC-based solutions over discrete transistors. Your designs tend to be mid-cost and very well-documented.
${JSON_SCHEMA}`,

  anthropic: `You are Claude Sonnet, an AI assistant made by Anthropic. You are designing a circuit.
Your style: prefer discrete BJT solutions (2N3904, BC547, MMBT3904) for minimum cost, use 5% resistors where possible.
You care about minimal BOM count, easy hand-soldering, and parts available on Indian market (LCSC India / local shops).
${JSON_SCHEMA}`,

  google: `You are Gemini 2.0 Flash, an AI assistant made by Google. You are designing a circuit.
Your style: prefer integrated regulator ICs (LM317, LM7805, AP2112), MOSFET-based designs (2N7002, AO3400) for efficiency.
You think about thermal management and long-term reliability. Your designs lean slightly larger but very robust.
${JSON_SCHEMA}`
};

async function claudeCall(persona, spec) {
  const resp = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': ANTHROPIC_KEY,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-5',
      max_tokens: 1024,
      system: PERSONAS[persona],
      messages: [{ role: 'user', content: `Design a circuit for this spec: "${spec}"` }]
    })
  });
  if (!resp.ok) {
    const err = await resp.json().catch(() => ({}));
    throw new Error((err.error && err.error.message) || 'Anthropic HTTP ' + resp.status);
  }
  const data = await resp.json();
  return parseJSON(data.content.map(b => b.text || '').join(''));
}

async function callOpenAI(spec)  { return claudeCall('openai',    spec); }
async function callClaude(spec)  { return claudeCall('anthropic', spec); }
async function callGemini(spec)  { return claudeCall('google',    spec); }

/* Helper: extract + parse JSON from any LLM response */
function parseJSON(raw) {
  const clean = raw.replace(/```json\s*/g, '').replace(/```/g, '').trim();
  const match = clean.match(/\{[\s\S]*\}/);
  if (!match) throw new Error('No JSON found in response');
  return JSON.parse(match[0]);
}

/* Route to correct API by engine */
async function callModel(spec, model) {
  if (model.engine === 'openai')    return callOpenAI(spec);
  if (model.engine === 'anthropic') return callClaude(spec);
  if (model.engine === 'google')    return callGemini(spec);
  throw new Error('Unknown engine: ' + model.engine);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NORMALIZE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function normalise(apiResult) {
  const comps = apiResult.components || [];
  return {
    topology:      apiResult.topology || 'unknown',
    components:    comps.map(c => c.ref + '_' + String(c.value).replace(/\s+/g,'_')),
    componentsRaw: comps,
    r_sense:       parseFloat(apiResult.r_sense_ohms) || 0,
    cost:          parseFloat(apiResult.total_cost_inr) || 0,
    size_mm:       apiResult.size_mm || '?',
    accuracy:      (parseFloat(apiResult.accuracy_pct) || 0) / 100,
    power_loss:    parseFloat(apiResult.power_loss_w) || 0,
    notes:         apiResult.notes || '',
    cost_notes:    apiResult.cost_breakdown_notes || '',
    physics_valid: !!apiResult.physics_valid,
    score:         parseFloat(apiResult.score) || 0
  };
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FILE GENERATORS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function genLTspice(d) {
  const ctrl = (d.componentsRaw && d.componentsRaw.find(c => c.ref && (c.ref[0]==='Q'||c.ref[0]==='U')));
  const ctrlVal = ctrl ? ctrl.value : '2N7002';
  return [
    'Version 4',
    'SHEET 1 880 680',
    'WIRE -48 48 -96 48',
    'WIRE 192 48 144 48',
    'WIRE 192 160 192 48',
    'WIRE 336 160 192 160',
    'FLAG 336 160 0',
    'FLAG -96 48 I_load',
    'SYMBOL current -96 32 R0',
    'WINDOW 123 0 0 Left 0',
    'WINDOW 39 0 0 Left 0',
    'SYMATTR InstName I1',
    'SYMATTR Value 15mA',
    '; ============================================',
    '; WINNER: ' + d.topology,
    '; Score:  ' + d.score.toFixed(1) + '/10',
    '; Cost:   Rs' + d.cost.toFixed(2) + ' INR (qty 10)',
    '; ' + d.cost_notes,
    '; Components: ' + d.components.join(', '),
    '; ============================================',
    '; ' + d.notes,
    'SYMBOL nmos 192 128 R0',
    'SYMATTR InstName M1',
    'SYMATTR Value "' + ctrlVal + '"',
    'SYMBOL res 336 144 R0',
    'SYMATTR InstName R1',
    'SYMATTR Value ' + d.r_sense,
    'TEXT -96 -64 Left 2 !.tran 1m'
  ].join('\n');
}

function uuid() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
    const r = Math.random()*16|0;
    return (c==='x' ? r : (r&0x3|0x8)).toString(16);
  });
}

function genKicad(d) {
  const topo = d.topology.toLowerCase();
  let ctrlRef = 'Q1', ctrlVal = '2N7002';
  if (d.componentsRaw) {
    const q = d.componentsRaw.find(c => c.ref && (c.ref[0]==='Q'||c.ref[0]==='U'));
    if (q) { ctrlRef = q.ref; ctrlVal = q.value; }
  }
  const rVal = Math.round(d.r_sense) || 68;

  return `(kicad_sch (version 20230121) (generator eeschema)

  (paper "A4")

  (title_block
    (title "AI Circuit Factory â€” ${d.topology}")
    (date "${new Date().toISOString().slice(0,10)}")
    (rev "1.0")
    (comment 1 "Score: ${d.score.toFixed(1)}/10  Cost: Rs${d.cost.toFixed(2)} INR")
    (comment 2 "${d.notes.replace(/"/g,"'")}")
    (comment 3 "${d.components.join(', ').replace(/"/g,"'")}")
  )

  (lib_symbols
    (symbol "Device:R" (pin_numbers hide) (pin_names (offset 0)) (in_bom yes) (on_board yes)
      (property "Reference" "R" (at 2.032 0 90) (effects (font (size 1.27 1.27))))
      (property "Value" "R" (at 0 0 90) (effects (font (size 1.27 1.27))))
      (property "Footprint" "" (at 0 0 0) (effects (font (size 1.27 1.27)) hide))
      (symbol "R_0_1"
        (rectangle (start -1.016 -2.032) (end 1.016 2.032)
          (stroke (width 0.2032) (type default)) (fill (type none))))
      (symbol "R_1_1"
        (pin passive "~" (at 0 3.81 270) (length 1.778)
          (name "~" (effects (font (size 1.27 1.27)))) (number "1" (effects (font (size 1.27 1.27)))))
        (pin passive "~" (at 0 -3.81 90) (length 1.778)
          (name "~" (effects (font (size 1.27 1.27)))) (number "2" (effects (font (size 1.27 1.27)))))))
    (symbol "Device:Q_NMOS_GSD" (in_bom yes) (on_board yes)
      (property "Reference" "Q" (at 5.08 1.27 0) (effects (font (size 1.27 1.27))))
      (property "Value" "Q_NMOS_GSD" (at 5.08 -1.27 0) (effects (font (size 1.27 1.27))))
      (symbol "Q_NMOS_GSD_1_1"
        (pin input "G" (at -5.08 0 0) (length 2.54)
          (name "G" (effects (font (size 1.27 1.27)))) (number "1" (effects (font (size 1.27 1.27)))))
        (pin passive "S" (at 5.08 -5.08 90) (length 2.54)
          (name "S" (effects (font (size 1.27 1.27)))) (number "2" (effects (font (size 1.27 1.27)))))
        (pin passive "D" (at 5.08 5.08 270) (length 2.54)
          (name "D" (effects (font (size 1.27 1.27)))) (number "3" (effects (font (size 1.27 1.27)))))))
    (symbol "power:VCC" (pin_names (offset 0)) (in_bom yes) (on_board yes)
      (property "Reference" "#PWR" (at 0 -1.905 0) (effects (font (size 1.27 1.27)) hide))
      (property "Value" "VCC" (at 0 3.81 0) (effects (font (size 1.27 1.27)))))
    (symbol "power:GND" (pin_names (offset 0)) (in_bom yes) (on_board yes)
      (property "Reference" "#PWR" (at 0 -1.905 0) (effects (font (size 1.27 1.27)) hide))
      (property "Value" "GND" (at 0 -3.81 0) (effects (font (size 1.27 1.27)))))
  )

  (symbol (lib_id "power:VCC") (at 95.25 30.48 0) (unit 1) (in_bom yes) (on_board yes)
    (uuid "${uuid()}")
    (property "Reference" "#PWR01" (at 95.25 34.29 0) (effects (font (size 1.27 1.27)) hide))
    (property "Value" "VCC" (at 95.25 26.67 0) (effects (font (size 1.27 1.27)))))

  (symbol (lib_id "power:GND") (at 95.25 165.1 0) (unit 1) (in_bom yes) (on_board yes)
    (uuid "${uuid()}")
    (property "Reference" "#PWR02" (at 95.25 171.45 0) (effects (font (size 1.27 1.27)) hide))
    (property "Value" "GND" (at 95.25 171.45 0) (effects (font (size 1.27 1.27)))))

  (symbol (lib_id "Device:Q_NMOS_GSD") (at 95.25 101.6 0) (unit 1) (in_bom yes) (on_board yes)
    (uuid "${uuid()}")
    (property "Reference" "${ctrlRef}" (at 100.33 100.33 0) (effects (font (size 1.27 1.27))))
    (property "Value" "${ctrlVal}" (at 100.33 102.87 0) (effects (font (size 1.27 1.27))))
    (property "Footprint" "Package_TO_SOT_THT:TO-92_Inline" (at 0 0 0) (effects (font (size 1.27 1.27)) hide)))

  (symbol (lib_id "Device:R") (at 95.25 139.7 0) (unit 1) (in_bom yes) (on_board yes)
    (uuid "${uuid()}")
    (property "Reference" "R1" (at 97.79 136.525 0) (effects (font (size 1.27 1.27))))
    (property "Value" "${rVal}R" (at 97.79 139.7 0) (effects (font (size 1.27 1.27))))
    (property "Footprint" "Resistor_SMD:R_0805_2012Metric" (at 0 0 0) (effects (font (size 1.27 1.27)) hide)))

  (wire (pts (xy 95.25 30.48) (xy 95.25 96.52)) (uuid "${uuid()}"))
  (wire (pts (xy 95.25 106.68) (xy 95.25 135.89)) (uuid "${uuid()}"))
  (wire (pts (xy 95.25 143.51) (xy 95.25 165.1)) (uuid "${uuid()}"))

  (sheet_instances (path "/" (page "1")))

)`;
}

function genBOM(d) {
  const lines = ['Ref,Value,Description,Qty,Package,Unit_Cost_INR,Line_Total_INR,Supplier'];
  let total = 0;
  const comps = d.componentsRaw || [];

  if (comps.length > 0) {
    comps.forEach(c => {
      const unit = parseFloat(c.unit_cost_inr) || 0;
      const qty  = parseInt(c.qty) || 1;
      const line = unit * qty;
      total += line;
      lines.push(`${c.ref},"${c.value}","${c.description}",${qty},SMD0805,${unit.toFixed(2)},${line.toFixed(2)},LCSC/DigiKey`);
    });
  } else {
    d.components.forEach((comp, i) => {
      const unit = d.cost / Math.max(d.components.length, 1);
      total += unit;
      lines.push(`Part${i+1},"${comp}","Component",1,SMD0805,${unit.toFixed(2)},${unit.toFixed(2)},DigiKey`);
    });
  }

  lines.push('');
  lines.push(`TOTAL,,,,,,${d.cost.toFixed(2)} INR,`);
  lines.push('');
  lines.push('# Cost basis: ' + (d.cost_notes || 'Estimated from market prices'));
  lines.push('# Prices are for qty=10 from LCSC/DigiKey/Mouser');
  return lines.join('\n');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TERMINAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function log(msg, cls) {
  const t = document.getElementById('terminal');
  const cursor = t.querySelector('.cursor-blink');
  const p = document.createElement('p');
  p.className = 'log ' + (cls || 'dim');
  p.textContent = msg;
  t.insertBefore(p, cursor);
  t.scrollTop = t.scrollHeight;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   UI HELPERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setSpec(el) {
  document.getElementById('spec-input').value = el.textContent;
  document.getElementById('spec-input').focus();
}

function toggleHIW() {
  const body  = document.getElementById('hiw-body');
  const arrow = document.getElementById('hiw-chevron');
  const open  = body.style.display !== 'none';
  body.style.display = open ? 'none' : 'block';
  arrow.classList.toggle('open', !open);
}

function switchTab(name, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tab-' + name).classList.add('active');
}

function download(filename, content) {
  const blob = new Blob([content], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

function esc(s) {
  return String(s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function renderCode(txt, lang) {
  const e = esc(txt);
  if (lang === 'ltspice') return e
    .replace(/(;[^\n]*)/g, '<span class="c-comment">$1</span>')
    .replace(/\b(SYMBOL|WIRE|FLAG|SYMATTR|WINDOW|TEXT|Version|SHEET)\b/g, '<span class="c-key">$1</span>');
  if (lang === 'kicad') return e
    .replace(/\b(kicad_sch|paper|title_block|lib_symbols|symbol|property|effects|font|pin|wire|at|uuid|in_bom|on_board|unit|lib_id)\b/g, '<span class="c-key">$1</span>');
  // CSV
  return e.split('\n').map((l,i) => i===0 ? `<span class="c-key">${l}</span>` : l).join('\n');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RENDER SCOREBOARD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderScoreboard(results, winnerKey) {
  const sb = document.getElementById('scoreboard');
  sb.innerHTML = '';
  results.forEach(r => {
    const d = r.design;
    const win = r.key === winnerKey;
    const pct = Math.round(d.score / 10 * 100);
    sb.innerHTML += `
      <div class="card ${win ? 'winner' : ''}">
        ${win ? '<span class="crown">ğŸ†</span>' : ''}
        <div class="card-name">${esc(r.modelName)}</div>
        <div class="card-role">${win ? '// WINNER' : '// CONTESTANT'}</div>
        <div class="card-score">${d.score.toFixed(1)}</div>
        <div class="card-score-label">/ 10.0 score</div>
        <div class="score-track"><div class="score-fill" style="width:0%" data-pct="${pct}"></div></div>
        <span class="validity-badge ${d.physics_valid ? 'valid' : 'invalid'}">
          ${d.physics_valid ? 'âœ“ PHYSICS VALID' : 'âœ— INVALID'}
        </span>
        <div class="card-meta">${esc(d.topology)}<br>â‚¹${d.cost.toFixed(2)} Â· ${esc(d.size_mm)}mm</div>
      </div>`;
  });
  setTimeout(() => {
    document.querySelectorAll('.score-fill').forEach(el => {
      el.style.width = el.dataset.pct + '%';
    });
  }, 120);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RENDER WINNER PANEL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderWinner(d) {
  let tableHtml = '';
  if (d.componentsRaw && d.componentsRaw.length > 0) {
    let rows = '';
    d.componentsRaw.forEach(c => {
      const unit = parseFloat(c.unit_cost_inr) || 0;
      const qty  = parseInt(c.qty) || 1;
      rows += `<tr>
        <td class="td-ref">${esc(c.ref)}</td>
        <td class="td-val">${esc(c.value)}</td>
        <td>${esc(c.description)}</td>
        <td class="td-num">${qty}</td>
        <td class="td-num">â‚¹${unit.toFixed(2)}</td>
        <td class="td-total">â‚¹${(unit*qty).toFixed(2)}</td>
      </tr>`;
    });
    tableHtml = `
      <div class="cost-header">COMPONENT COST BREAKDOWN (QTY 10 Â· LCSC / DIGIKEY)</div>
      <table class="cost-table">
        <thead><tr>
          <th>Ref</th><th>Value</th><th>Description</th>
          <th>Qty</th><th>Unit â‚¹</th><th>Total â‚¹</th>
        </tr></thead>
        <tbody>${rows}</tbody>
        <tfoot><tr>
          <td colspan="5" style="color:var(--muted);font-family:var(--mono);font-size:11px;">TOTAL BOM (qty 10)</td>
          <td style="text-align:right;color:var(--green);font-family:var(--display);font-size:16px;font-weight:700;">â‚¹${d.cost.toFixed(2)}</td>
        </tr></tfoot>
      </table>
      ${d.cost_notes ? `<div class="cost-basis">ğŸ’° ${esc(d.cost_notes)}</div>` : ''}`;
  }

  document.getElementById('winner-panel').innerHTML = `
    <div class="wp-head">
      <div>
        <div class="wp-title">${esc(d.topology.replace(/_/g,' '))}</div>
        <div class="wp-subtitle">${esc(d.notes)}</div>
      </div>
      <div class="wp-metrics">
        <div class="metric"><span class="metric-val">${d.score.toFixed(1)}</span><span class="metric-label">Score</span></div>
        <div class="metric"><span class="metric-val">â‚¹${d.cost.toFixed(2)}</span><span class="metric-label">Cost INR</span></div>
        <div class="metric"><span class="metric-val">${Math.round(d.accuracy*100)}%</span><span class="metric-label">Accuracy</span></div>
        <div class="metric"><span class="metric-val">${esc(d.size_mm)}</span><span class="metric-label">Size mm</span></div>
      </div>
    </div>
    <div class="comp-tags">
      ${d.components.map(c => `<span class="comp-tag">${esc(c)}</span>`).join('')}
    </div>
    <div class="wp-note">R_sense = ${d.r_sense}Î© &nbsp;Â·&nbsp; Power loss â‰ˆ ${d.power_loss}W</div>
    ${tableHtml}`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RENDER FILE TABS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderFileTabs(d, slug) {
  const ltFile  = slug + '_driver.asc';
  const kcFile  = slug + '_driver.kicad_sch';
  const bomFile = slug + '_BOM.csv';

  document.getElementById('tab-ltspice').innerHTML = `
    <pre class="code">${renderCode(currentFiles.ltspice, 'ltspice')}</pre>
    <div class="dl-bar">
      <span class="dl-meta">${esc(ltFile)} &nbsp;Â·&nbsp; ${currentFiles.ltspice.length} bytes &nbsp;Â·&nbsp; LTspice XVII</span>
      <button class="dl-btn" onclick="download('${esc(ltFile)}', currentFiles.ltspice)">â¬‡ DOWNLOAD .ASC</button>
    </div>`;

  document.getElementById('tab-kicad').innerHTML = `
    <pre class="code">${renderCode(currentFiles.kicad, 'kicad')}</pre>
    <div class="dl-bar">
      <span class="dl-meta">${esc(kcFile)} &nbsp;Â·&nbsp; ${currentFiles.kicad.length} bytes &nbsp;Â·&nbsp; KiCad 6+</span>
      <button class="dl-btn green" onclick="download('${esc(kcFile)}', currentFiles.kicad)">â¬‡ DOWNLOAD .KICAD_SCH</button>
    </div>`;

  document.getElementById('tab-bom').innerHTML = `
    <pre class="code">${renderCode(currentFiles.bom, 'csv')}</pre>
    <div class="dl-bar">
      <span class="dl-meta">${esc(bomFile)} &nbsp;Â·&nbsp; ${currentFiles.bom.length} bytes &nbsp;Â·&nbsp; DigiKey / Mouser</span>
      <button class="dl-btn orange" onclick="download('${esc(bomFile)}', currentFiles.bom)">â¬‡ DOWNLOAD .CSV</button>
    </div>`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   MAIN RUN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const delay = ms => new Promise(r => setTimeout(r, ms));

async function runFactory() {
  const spec = document.getElementById('spec-input').value.trim();
  if (!spec) { document.getElementById('spec-input').focus(); return; }

  const btn = document.getElementById('run-btn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span>RUNNING';

  // Reset UI
  const term = document.getElementById('terminal');
  term.innerHTML = '<span class="cursor-blink"></span>';
  document.getElementById('arena').classList.remove('visible');

  log(`> run_competition("${spec}")`, 'info');
  await delay(80);
  log('// Calling GPT-4o Â· Claude Sonnet Â· Gemini 1.5 Flash in parallel...', 'dim');
  await delay(100);

  const results = [];

  const promises = AI_MODELS.map(async model => {
    try {
      log(`  ${model.name.padEnd(16)} â†’ querying...`, 'dim');
      const raw = await callModel(spec, model);
      const design = normalise(raw);
      results.push({ modelName: model.name, key: model.key, design });
      log(`  ${model.name.padEnd(16)} âœ“  score=${design.score.toFixed(1)}/10  â‚¹${design.cost.toFixed(2)}  [${design.topology}]`, 'ok');
    } catch (err) {
      log(`  ${model.name.padEnd(16)} âœ—  ${err.message}`, 'warn');
    }
  });

  await Promise.all(promises);

  if (results.length === 0) {
    log('// All 3 API calls failed. Check your keys and network.', 'warn');
    btn.disabled = false;
    btn.innerHTML = 'RUN â–¶';
    return;
  }

  await delay(100);

  const winnerEntry = results.reduce((best, r) => r.design.score > best.design.score ? r : best);
  const winner = winnerEntry.design;

  log(`// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`, 'dim');
  log(`// WINNER: ${winnerEntry.modelName} â€” ${winner.topology}`, 'info');
  log(`// Score:  ${winner.score.toFixed(1)}/10  Â·  â‚¹${winner.cost.toFixed(2)} INR`, 'info');
  if (winner.cost_notes) log(`// Cost:   ${winner.cost_notes}`, 'dim');

  const slug = winner.topology.toLowerCase().replace(/[^a-z0-9]+/g,'_');
  currentFiles = {
    ltspice: genLTspice(winner),
    kicad:   genKicad(winner),
    bom:     genBOM(winner)
  };

  log(`// Generated: ${slug}_driver.asc`, 'ok');
  log(`// Generated: ${slug}_driver.kicad_sch`, 'ok');
  log(`// Generated: ${slug}_BOM.csv  (${(winner.componentsRaw||[]).length} line items)`, 'ok');
  log('// All files ready. âœ¨', 'info');

  renderScoreboard(results, winnerEntry.key);
  renderWinner(winner);
  renderFileTabs(winner, slug);

  const arena = document.getElementById('arena');
  arena.classList.add('visible');
  arena.scrollIntoView({ behavior: 'smooth', block: 'start' });

  runCount++;
  localStorage.setItem('cf_runs', runCount);
  document.getElementById('total-runs').textContent = runCount;

  btn.disabled = false;
  btn.innerHTML = 'RUN â–¶';
}

// Enter key
document.getElementById('spec-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') runFactory();
});
</script>
</body>
</html>
